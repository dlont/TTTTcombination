Fre 12 Aug 2016 17:36:44 CEST;
Copy ICHEP/PAS datacards from Lana

```
cp -a /user/lbeck/ThirteenTeV/CMSSW_7_1_5/src/ApprovalFactor4/* .
```
Merge SUSY and TOP datacards
```
combineCards.py TOP=../pascards/TotalChannelCombination.txt SUSY=../uaf-6.t2.ucsd.edu/~namin/dump/fourtop_combination_Aug10/v6.02-tttt/card_tttt_2.3ifb-all.txt > data/v0.0/16-08-12-18-17/card-top-all-susy-all.txt
```

Run combine tool on merged file
```
combine -M Asymptotic data/v0.0/16-08-12-18-17/card-top-all-susy-all.txt > result/16-08-12-18-25/combine.asymptotic.out
```

Received the Error:
```
Error in <TFile::TFile>: file ../uaf-6.t2.ucsd.edu/~namin/dump/fourtop_combination_Aug10/v6.02-tttt/v6.02-tttt/data_histos_hihi_2.3ifb.root does not exist
```

After manualy fixing the paths to the shape files in the data/v0.0/16-08-12-18-17/card-top-all-susy-all.txt. Combine tool runs about one minute long.
> Observed Limit: r < 7.5667
> Expected  2.5%: r < 3.3371
> Expected 16.0%: r < 4.6791
> Expected 50.0%: r < 7.0312
> Expected 84.0%: r < 10.7588
> Expected 97.5%: r < 16.0284

These limits can be compared to SUSY 2016 ones
> Observed Limit: r < 6.2128
> Expected  2.5%: r < 2.5093
> Expected 16.0%: r < 3.4626
> Expected 50.0%: r < 5.0781
> Expected 84.0%: r < 7.6083
> Expected 97.5%: r < 10.9437

**2016 SUSY limit is better than TOP/SUSY 2015 combination**


Die 16 Aug 2016 23:59:41 CEST
Working on combine output formating. Created dedicated Makefile and adjusted parseLimit.py script

It is possible to parse combine output using 
```
make -B  format FMT=txt INPUT=result/16-08-12-18-25/combine.asymptotic.out
```


Mit 17 Aug 2016 01:40:14 CEST
Add json output support. New option can is invoked by 
```
make -B format FMT=json INPUT=result/16-08-12-18-25/combine.asymptotic.out OUTPUTJSON=YO1.json
```

Don 18 Aug 2016 17:05:20 CEST
Add datacards labels remaping. SED script defining the map located at ./util/remaplabels.sed
To make the replacement in the files use:
```
make -B remaplabels INPUT=data/v0.0/16-08-12-18-17/card-top-all-susy-all.txt OUTPUT=test.remap
```


Fre 19 Aug 2016 01:14:05 CEST
Add python script for histogram names remaping. Currently the map is hardcoded in the script itself.
WARNING!!! The script overwrites original file.
To apply histogram renaming script to a list of ROOT files do:
```
for file in ../uaf-6.t2.ucsd.edu/~namin/dump/fourtop_combination_Aug10_histrelabel/v6.02-tttt/tttt_*.root; do ./util/remaphistograms.py -r $file;done
```

Preparing input datacards and shape ROOT files for new round of limit extraction. Change processes and systematics labels to match TOP analysis.
```
mkdir -p data/v0.1/`date +%y-%m-%d-%H-%M`
make -B remaplabels INPUT=../uaf-6.t2.ucsd.edu/~namin/dump/fourtop_combination_Aug10/v6.02-tttt/card_tttt_2.3ifb-all.txt OUTPUT=data/v0.1/16-08-19-01-35/card_tttt_2.3ifb-all.txt
combineCards.py TOP=../pascards/TotalChannelCombination.txt SUSY=data/v0.1/16-08-19-01-35/card_tttt_2.3ifb-all.txt > data/v0.1/16-08-19-01-35/card-top-all-susy-all.txt
```
Paths to ROOT shape files are have to be fixed again as in v0.0 version of combined datacard. This time one has to take into accout difference in the path to shape files with renamed histograms.

Comparison of the v0.0 and v0.1 versions of the card-top-all-susy-all.txt shows that pu and tttt labels were correctly treated in the SUSY input
```
/usr/bin/python /usr/bin/meld data/v0.0/16-08-12-18-17/card-top-all-susy-all.txt data/v0.1/16-08-19-01-35/card-top-all-susy-all.txt
```


Fre 19 Aug 2016 02:49:39 CEST
Add JES unc from SUSY to the list of relabeled systematics.
ROOT shape files ../uaf-6.t2.ucsd.edu/~namin/dump/fourtop_combination_Aug10_histrelabel/v6.02-tttt/tttt_* were updated using the latest version of the ./util/remaphistograms.py script including 'jes' map (see d55cf0f)
```
for file in ../uaf-6.t2.ucsd.edu/~namin/dump/fourtop_combination_Aug10_histrelabel/v6.02-tttt/tttt_*.root; do ./util/remaphistograms.py -r $file;done
```

datacards were updated accordingly
```
mkdir -p data/v0.1.1/`date +%y-%m-%d-%H-%M`
make -B remaplabels INPUT=../uaf-6.t2.ucsd.edu/~namin/dump/fourtop_combination_Aug10/v6.02-tttt/card_tttt_2.3ifb-all.txt OUTPUT=data/v0.1.1/16-08-19-02-50/card_tttt_2.3ifb-all.txt
combineCards.py TOP=../pascards/TotalChannelCombination.txt SUSY=data/v0.1.1/16-08-19-02-50/card_tttt_2.3ifb-all.txt > data/v0.1.1/16-08-19-02-50/card-top-all-susy-all.txt
```
The path to shape files was fixed manually
There was a bug in util/remaplabels.sed affecting jes relabling. The bug is fixed in d6aebbf.
Repeat again after the bug fex.
```
mkdir -p data/v0.1.1/`date +%y-%m-%d-%H-%M`
make -B remaplabels INPUT=../uaf-6.t2.ucsd.edu/~namin/dump/fourtop_combination_Aug10/v6.02-tttt/card_tttt_2.3ifb-all.txt OUTPUT=data/v0.1.1/16-08-19-03-09/card_tttt_2.3ifb-all.txt
combineCards.py TOP=../pascards/TotalChannelCombination.txt SUSY=data/v0.1.1/16-08-19-03-09/card_tttt_2.3ifb-all.txt > data/v0.1.1/16-08-19-03-09/card-top-all-susy-all.txt
```

Fre 19 Aug 2016 03:18:09 CEST
Run combination
```
combine --verbose=5 -M Asymptotic data/v0.1.1/16-08-19-03-09/card-top-all-susy-all.txt > result/16-08-19-03-19/combine.asymptotic.out
```
Crashes because of missing systematic histograms. Instead of `for file in ../uaf-6.t2.ucsd.edu/~namin/dump/fourtop_combination_Aug10_histrelabel/v6.02-tttt/tttt_*.root`. I repeat `for file in ../uaf-6.t2.ucsd.edu/~namin/dump/fourtop_combination_Aug10_histrelabel/v6.02-tttt/*.root` and re-run combine.
This doesn't sovlve the crash problem. I suspect that this is due to missing jes and pu syst histograms in ../uaf-6.t2.ucsd.edu/~namin/dump/fourtop_combination_Aug10_histrelabel/v6.02-tttt/flips_histos_hilow_2.3ifb.root (see verbose output of combine). However, I don't understand how it was working before.



